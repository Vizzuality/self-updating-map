/*1.1*/L.CartoDBPopup=L.Class.extend({includes:L.Mixin.Events,options:{minWidth:50,maxWidth:300,maxHeight:null,autoPan:true,closeButton:true,offset:new L.Point(58,2),autoPanPadding:new L.Point(5,5),className:""},initialize:function(a,b){L.Util.setOptions(this,a);this._source=b},onAdd:function(a){this._map=a;if(!this._container){this._initLayout()}this._updateContent();this._container.style.opacity="0";a._panes.popupPane.appendChild(this._container);a.on("viewreset",this._updatePosition,this);if(a.options.closePopupOnClick){a.on("preclick",this._close,this)}this._update();this._container.style.opacity="1"},onRemove:function(a){a._panes.popupPane.removeChild(this._container);L.Util.falseFn(this._container.offsetWidth);a.off("viewreset",this._updatePosition,this).off("preclick",this._close,this);this._container.style.opacity="0";this._map=null},setLatLng:function(a){this._latlng=a;this._update();return this},setContent:function(a){this._content=a;this._update();return this},_close:function(){var b=this._map;if(b){b._popup=null;var c=this._container,a=this;emile(c,{bottom:"-="+10+"px",opacity:0,duration:100,after:function(){b.removeLayer(a).fire("popupclose",{popup:a})}})}},_initLayout:function(){var c="cartodb-popup",a=this._container=L.DomUtil.create("div",c+" "+this.options.className),b;if(this.options.closeButton){b=this._closeButton=L.DomUtil.create("a",c+"-close-button",a);b.href="#close";b.innerHTML="x";L.DomEvent.addListener(b,"click",this._onCloseButtonClick,this);L.DomEvent.addListener(b,"touchend",this._onCloseButtonClick,this);L.DomEvent.disableClickPropagation(b)}var d=this._wrapper=L.DomUtil.create("div",c+"-content-wrapper",a);L.DomEvent.disableClickPropagation(d);this._contentNode=L.DomUtil.create("div",c+"-content",d);L.DomEvent.addListener(this._contentNode,"mousewheel",L.DomEvent.stopPropagation);this._tipContainer=L.DomUtil.create("div",c+"-tip-container",a);this._tip=L.DomUtil.create("div",c+"-tip",this._tipContainer)},_update:function(){if(!this._map){return}this._container.style.visibility="hidden";this._updateContent();this._updateLayout();this._updatePosition();this._container.style.opacity=0;this._container.style.visibility="visible";emile(this._container,{opacity:1,duration:200});this._adjustPan()},_updateContent:function(){if(!this._content){return}if(typeof this._content==="string"){this._contentNode.innerHTML=this._content}else{this._contentNode.innerHTML="";var a="";for(var b in this._content){if(b=="cartodb_id"){this._tipContainer.innerHTML="<label>id: <strong>"+this._content[b]+"</strong></label>"}else{a+="<label>"+b+"</label>";a+='<p class="'+((this._content[b]!=null&&this._content[b]!="")?"":"empty")+'">'+(this._content[b]||"empty")+"</p>"}}this._contentNode.innerHTML=a}this.fire("contentupdate")},_updateLayout:function(){var b=this._contentNode;b.style.width="";b.style.whiteSpace="nowrap";var c=b.offsetWidth;c=Math.min(c,this.options.maxWidth);c=Math.max(c,this.options.minWidth);b.style.width=(c+1)+"px";b.style.whiteSpace="";b.style.height="";var a=b.offsetHeight,d=this.options.maxHeight,e=" leaflet-popup-scrolled";if(d&&a>d){b.style.height=d+"px";b.className+=e}else{b.className=b.className.replace(e,"")}this._containerWidth=this._container.offsetWidth},_updatePosition:function(){var a=this._map.latLngToLayerPoint(this._latlng);this._containerBottom=-a.y-this.options.offset.y;this._containerLeft=a.x-Math.round(this._containerWidth/2)+this.options.offset.x;this._container.style.bottom=this._containerBottom+"px";this._container.style.left=this._containerLeft+"px"},_adjustPan:function(){if(!this.options.autoPan){return}var g=this._map,d=this._container.offsetHeight,c=this._containerWidth,a=new L.Point(this._containerLeft,-d-this._containerBottom),h=g.layerPointToContainerPoint(a),f=new L.Point(0,0),e=this.options.autoPanPadding,b=g.getSize();if(h.x<0){f.x=h.x-e.x}if(h.x+c>b.x){f.x=h.x+c-b.x+e.x}if(h.y<0){f.y=h.y-e.y}if(h.y+d>b.y){f.y=h.y+d-b.y+e.y}if(f.x||f.y){g.panBy(f)}},_onCloseButtonClick:function(a){this._close();L.DomEvent.stop(a)}});
!function(ae){function O(f,e){f=typeof f=="string"?document.getElementById(f):f,e=C(e);var h={duration:e.duration,easing:e.easing,after:e.after};delete e.duration,delete e.easing,delete e.after;if(aa&&typeof h.easing!="function"){return D(f,e,h)}var g=N(e,function(d,c){d=K(d);return P(d) in X&&Y.test(c)?[d,c+"px"]:[d,c]});E(f,g,h)}function C(e){var d={};for(var f in e){d[f]=e[f],f=="after"&&delete e[f]}return d}function D(r,q,p){var o=[],n=[],l=p.duration||1000,h=p.easing||"ease-out",g="";l=l+"ms",r.addEventListener(T,function e(){r.setAttribute("style",g),p.after&&p.after(),r.removeEventListener(T,e,!0)},!0),setTimeout(function(){var b;for(b in q){q.hasOwnProperty(b)&&o.push(K(b)+" "+l+" "+h)}for(b in q){var a=P(b) in X&&Y.test(q[b])?q[b]+"px":q[b];q.hasOwnProperty(b)&&(r.style[P(b)]=a)}g=r.getAttribute("style"),o=o.join(","),r.style[aa+"Transition"]=o},10)}function E(z,y,x,w){x=x||{};var v=F(y),u=z.currentStyle?z.currentStyle:getComputedStyle(z,null),t={},s=+(new Date),r,q=x.duration||200,p=s+q,o,n=x.easing||function(b){return -Math.cos(b*Math.PI)/2+0.5};for(r in v){t[r]=G(u[r])}o=setInterval(function(){var a=+(new Date),d,c=a>p?1:(a-s)/q;for(d in v){z.style[d]=v[d].f(t[d].v,v[d].v,n(c))+v[d].u}a>p&&(clearInterval(o),x.after&&x.after(),w&&setTimeout(w,1))},10)}function F(b){var j,i={},h=U.length,g;ad.innerHTML='<div style="'+b+'"></div>',j=ad.childNodes[0].style;while(h--){(g=j[U[h]])&&(i[U[h]]=G(g))}return i}function G(e){var d=parseFloat(e),f=e?e.replace(/^[\-\d\.]+/,""):e;return isNaN(d)?{v:f,f:H,u:""}:{v:d,f:J,u:f}}function H(r,q,p){var o=2,n,m,l,k=[],j=[];while((n=3)&&(m=arguments[o-1])&&o--){if(I(m,0)=="r"){m=m.match(/\d+/g);while(n--){k.push(~~m[n])}}else{m.length==4&&(m="#"+I(m,1)+I(m,1)+I(m,2)+I(m,2)+I(m,3)+I(m,3));while(n--){k.push(parseInt(I(m,1+n*2,2),16))}}}while(n--){l=~~(k[n+3]+(k[n]-k[n+3])*p),j.push(l<0?0:l>255?255:l)}return"rgb("+j.join(",")+")"}function I(e,d,f){return e.substr(d,f||1)}function J(e,d,f){return(e+(d-e)*f).toFixed(3)}function K(b){if(b.toUpperCase()===b){return b}return b.replace(/([a-zA-Z0-9])([A-Z])/g,function(e,d,f){return d+"-"+f}).toLowerCase()}function N(d,c){return Q(d,function(b,f){var e=c?c(f,b):[f,b];return e[0]+":"+e[1]+";"}).join("")}function P(b){return b.replace(/-(.)/g,function(d,c){return c.toUpperCase()})}function Q(g,f,j){var i=[],h;for(h in g){i.push(f.call(j,g[h],h,g))}return i}var ad=document.createElement("div"),ac=["webkit","Moz","O"],ab=3,aa,Z,Y=/\d+$/,X={},W="backgroundColor borderBottomColor borderLeftColor borderRightColor borderTopColor color fontWeight lineHeight opacity outlineColor zIndex",V="top bottom left right borderWidth borderBottomWidth borderLeftWidth borderRightWidth borderTopWidth borderSpacing borderRadius marginBottom marginLeft marginRight marginTop width height maxHeight maxWidth minHeight minWidth paddingBottom paddingLeft paddingRight paddingTop fontSize wordSpacing textIndent letterSpacing outlineWidth outlineOffset",U=(W+" "+V).split(" ");while(ab--){Z=ac[ab],ad.style.cssText="-"+Z.toLowerCase()+"-transition-property:opacity;",typeof ad.style[Z+"TransitionProperty"]!="undefined"&&(aa=Z)}var T=/^w/.test(aa)?"webkitTransitionEnd":"transitionend";for(var S=V.split(" "),R=S.length;R--;){X[S[R]]=1}var M=ae.emile;O.noConflict=function(){ae.emile=M;return this},ae.emile=O}(this);